<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>🔨 新生代总结 JavaScript 运行机制解析 | 小丞前端之路</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/orange.png">
    <meta name="description" content="引言 在一些面试中，我们或许会被问到这样的问题 还有可能会被问这样的代码 这些虽然看起来很深奥很复杂，但是如果你了解了 JavaScript 的运行机制，这些问题都能够一一化解">
    
    <link rel="preload" href="/assets/css/0.styles.c6d750c1.css" as="style"><link rel="preload" href="/assets/js/app.84aca76e.js" as="script"><link rel="preload" href="/assets/js/2.195f2158.js" as="script"><link rel="preload" href="/assets/js/55.6a8113fb.js" as="script"><link rel="prefetch" href="/assets/js/10.19dacd57.js"><link rel="prefetch" href="/assets/js/11.554dfe83.js"><link rel="prefetch" href="/assets/js/12.872cae40.js"><link rel="prefetch" href="/assets/js/13.49623c48.js"><link rel="prefetch" href="/assets/js/14.820dbeb4.js"><link rel="prefetch" href="/assets/js/15.8e03246d.js"><link rel="prefetch" href="/assets/js/16.02f01159.js"><link rel="prefetch" href="/assets/js/17.40710f51.js"><link rel="prefetch" href="/assets/js/18.eb977535.js"><link rel="prefetch" href="/assets/js/19.e9c20797.js"><link rel="prefetch" href="/assets/js/20.741e51c3.js"><link rel="prefetch" href="/assets/js/21.60b540ac.js"><link rel="prefetch" href="/assets/js/22.cfaa5929.js"><link rel="prefetch" href="/assets/js/23.eaa38f81.js"><link rel="prefetch" href="/assets/js/24.734bd00e.js"><link rel="prefetch" href="/assets/js/25.526c02ff.js"><link rel="prefetch" href="/assets/js/26.ae528570.js"><link rel="prefetch" href="/assets/js/27.f6d05eee.js"><link rel="prefetch" href="/assets/js/28.e13ce5e2.js"><link rel="prefetch" href="/assets/js/29.d44f5e71.js"><link rel="prefetch" href="/assets/js/3.9ef2866a.js"><link rel="prefetch" href="/assets/js/30.46ef531d.js"><link rel="prefetch" href="/assets/js/31.92a3ad27.js"><link rel="prefetch" href="/assets/js/32.b7a8a4bb.js"><link rel="prefetch" href="/assets/js/33.5f8bcb25.js"><link rel="prefetch" href="/assets/js/34.9d1ef303.js"><link rel="prefetch" href="/assets/js/35.314c49c4.js"><link rel="prefetch" href="/assets/js/36.82828e59.js"><link rel="prefetch" href="/assets/js/37.d11e77ed.js"><link rel="prefetch" href="/assets/js/38.1ba8c945.js"><link rel="prefetch" href="/assets/js/39.006d6795.js"><link rel="prefetch" href="/assets/js/4.d68eba5c.js"><link rel="prefetch" href="/assets/js/40.a0757091.js"><link rel="prefetch" href="/assets/js/41.0465ba85.js"><link rel="prefetch" href="/assets/js/42.ad52fa52.js"><link rel="prefetch" href="/assets/js/43.0ca69b9d.js"><link rel="prefetch" href="/assets/js/44.fcbe4b55.js"><link rel="prefetch" href="/assets/js/45.c1f60df9.js"><link rel="prefetch" href="/assets/js/46.aaf4c807.js"><link rel="prefetch" href="/assets/js/47.0d7af8bb.js"><link rel="prefetch" href="/assets/js/48.6bac5f1d.js"><link rel="prefetch" href="/assets/js/49.e62f1089.js"><link rel="prefetch" href="/assets/js/5.73e212b6.js"><link rel="prefetch" href="/assets/js/50.643246ed.js"><link rel="prefetch" href="/assets/js/51.dacd1276.js"><link rel="prefetch" href="/assets/js/52.fce8bdff.js"><link rel="prefetch" href="/assets/js/53.e7921e5a.js"><link rel="prefetch" href="/assets/js/54.f42c4ff3.js"><link rel="prefetch" href="/assets/js/56.24479220.js"><link rel="prefetch" href="/assets/js/57.d18d7f86.js"><link rel="prefetch" href="/assets/js/58.533f3d2c.js"><link rel="prefetch" href="/assets/js/59.8e258a6a.js"><link rel="prefetch" href="/assets/js/6.c352959d.js"><link rel="prefetch" href="/assets/js/60.4d2d6af0.js"><link rel="prefetch" href="/assets/js/61.346c29af.js"><link rel="prefetch" href="/assets/js/7.a48ee71d.js"><link rel="prefetch" href="/assets/js/8.7c498576.js"><link rel="prefetch" href="/assets/js/9.8a5b8813.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c6d750c1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/orange.png" alt="小丞前端之路" class="logo"> <span class="site-name can-hide">小丞前端之路</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="各类知识点" class="dropdown-title"><span class="title">各类知识点</span> <span class="arrow down"></span></button> <button type="button" aria-label="各类知识点" class="mobile-dropdown-title"><span class="title">各类知识点</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/summary/qrcode.html" class="nav-link">
  前端总结
</a></li><li class="dropdown-item"><!----> <a href="/pages/structure/start.html" class="nav-link">
  数据结构和算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端面试合集" class="dropdown-title"><span class="title">前端面试合集</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端面试合集" class="mobile-dropdown-title"><span class="title">前端面试合集</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/interview/heading/best1.html" class="nav-link">
  面试题精选
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React 全家桶" class="dropdown-title"><span class="title">React 全家桶</span> <span class="arrow down"></span></button> <button type="button" aria-label="React 全家桶" class="mobile-dropdown-title"><span class="title">React 全家桶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/react/primary/jsx.html" class="nav-link">
  React 入门
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于我" class="dropdown-title"><span class="title">关于我</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于我" class="mobile-dropdown-title"><span class="title">关于我</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/about/about.html" class="nav-link">
  关于我
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/linjunc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1460594842018446" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/m0_50855872" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="各类知识点" class="dropdown-title"><span class="title">各类知识点</span> <span class="arrow down"></span></button> <button type="button" aria-label="各类知识点" class="mobile-dropdown-title"><span class="title">各类知识点</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/summary/qrcode.html" class="nav-link">
  前端总结
</a></li><li class="dropdown-item"><!----> <a href="/pages/structure/start.html" class="nav-link">
  数据结构和算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端面试合集" class="dropdown-title"><span class="title">前端面试合集</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端面试合集" class="mobile-dropdown-title"><span class="title">前端面试合集</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/interview/heading/best1.html" class="nav-link">
  面试题精选
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React 全家桶" class="dropdown-title"><span class="title">React 全家桶</span> <span class="arrow down"></span></button> <button type="button" aria-label="React 全家桶" class="mobile-dropdown-title"><span class="title">React 全家桶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/react/primary/jsx.html" class="nav-link">
  React 入门
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于我" class="dropdown-title"><span class="title">关于我</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于我" class="mobile-dropdown-title"><span class="title">关于我</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/about/about.html" class="nav-link">
  关于我
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/linjunc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1460594842018446" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/m0_50855872" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端总结</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/summary/qrcode.html" class="sidebar-link">如何优雅的在 H5 网页中实现扫码功能</a></li><li><a href="/pages/summary/animate.html" class="sidebar-link">为什么 CSS 动画比 JavaScript 高效？</a></li><li><a href="/pages/summary/git.html" class="sidebar-link">通俗易懂的GIT入门</a></li><li><a href="/pages/summary/prototype.html" class="sidebar-link">三张图轻松KO⚡ JS 原型和原型链</a></li><li><a href="/pages/summary/v8.html" class="sidebar-link">你知道 V8 是如何执行JS代码的吗？</a></li><li><a href="/pages/summary/weakmap.html" class="sidebar-link">浅析 Map 和 WeakMap 区别以及使用场景</a></li><li><a href="/pages/summary/jsrun.html" aria-current="page" class="active sidebar-link">新生代总结 JavaScript 运行机制解析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/summary/jsrun.html#引言" class="sidebar-link">引言</a></li><li class="sidebar-sub-header"><a href="/pages/summary/jsrun.html#_1-为什么是单线程" class="sidebar-link">1. 为什么是单线程？</a></li><li class="sidebar-sub-header"><a href="/pages/summary/jsrun.html#_2-为什么需要异步" class="sidebar-link">2. 为什么需要异步？</a></li><li class="sidebar-sub-header"><a href="/pages/summary/jsrun.html#_3-事件循环" class="sidebar-link">3. 事件循环</a></li><li class="sidebar-sub-header"><a href="/pages/summary/jsrun.html#_4-异步任务队列细节" class="sidebar-link">4. 异步任务队列细节</a></li><li class="sidebar-sub-header"><a href="/pages/summary/jsrun.html#_5-宏任务和微任务" class="sidebar-link">5. 宏任务和微任务</a></li><li class="sidebar-sub-header"><a href="/pages/summary/jsrun.html#_6-实战" class="sidebar-link">6. 实战</a></li></ul></li><li><a href="/pages/summary/inherit.html" class="sidebar-link">JS 继承的7种方法，你学会了吗？</a></li><li><a href="/pages/summary/arrayapi.html" class="sidebar-link">原生 JavaScript 手写数组 API</a></li><li><a href="/pages/summary/iterator.html" class="sidebar-link">【深扒】JavaScript 中的迭代器</a></li><li><a href="/pages/summary/generator.html" class="sidebar-link">【深扒】JavaScript 中的生成器</a></li><li><a href="/pages/summary/highf.html" class="sidebar-link">JavaScript中的高阶函数</a></li><li><a href="/pages/summary/npm.html" class="sidebar-link">经常使用npm命令，你真的知道它的意思吗？</a></li><li><a href="/pages/summary/storage.html" class="sidebar-link">Javascript客户端存储技术你知道多少？</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>📢 大家好，我是小丞同学，一名<font color="#2e86de">准大二的前端爱好者</font></p> <p>📢 这篇文章将带你一起学习理解 JavaScript 运行机制</p> <p>📢 <font color="#f368e0"><strong>愿你忠于自己，热爱生活</strong></font></p></blockquote> <h2 id="引言"><a href="#引言" class="header-anchor">#</a> 引言</h2> <p>在一些面试中，我们或许会被问到这样的问题</p> <blockquote><p>简述一下 JavaScript 的运行机制？</p></blockquote> <p>还有可能会被问这样的代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'定时器开始啦'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'马上执行for循环啦'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        i <span class="token operator">==</span> <span class="token number">99</span> <span class="token operator">&amp;&amp;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'执行then函数啦'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>这些虽然看起来很深奥很复杂，但是如果你了解了 JavaScript 的运行机制，这些问题都能够一一化解</p> <p>先附上本文的纲要，本文将会从这<strong>三个方面</strong>去解析 JavaScript 的运行机制</p> <p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210819095110499.png" alt="image-20210819095110499"></p> <p>首先我们来谈谈 JavaScript 的单线程</p> <h2 id="_1-为什么是单线程"><a href="#_1-为什么是单线程" class="header-anchor">#</a> 1. 为什么是单线程？</h2> <p>众所周知，JavaScript 是一门单线程的语言，也因此带来了很多诟病，那么单线程如此不堪，为什么不把它设计成多线程的呢？</p> <p>其实这个问题就出现在了 JavaScript 的<strong>应用场景</strong>上，我们通常采用 JavaScript 来操作 DOM 元素，这在现在来看没什么问题。但是我们想一想，如果 JavaScript 变成了一门多线程的语言，那会发生什么呢？</p> <p>想象一下下面的场景</p> <p>一段 JS 代码<strong>删除</strong> DOM 元素，一段 JS 代码<strong>更改</strong> DOM 元素样式，它们一起被执行了，这会发生什么？</p> <p>先别说浏览器该怎么处理了，我都不知道该如何处理，那浏览器就会崩溃掉 ...</p> <p>为了避免这样的情况， JavaScript 被设计成了一门单线程的语言</p> <p>单线程就意味着，一次只能执行一个任务，其他任务都需要排队等待</p> <p>但是为了能有多线程的功能，有了很多的尝试</p> <p>在 HTML5 中提出了 <code>web worker</code> 标准，它提供了一套完整的 API 去允许在主线程以外<strong>去执行另一个线程</strong>，但是这<strong>不意味</strong>着 JavaScript 从此拥有了多线程的能力，同时我们也不能用它来操作 DOM 元素。</p> <p>在 JavaScript 中还有着独特执行机制，它将主线程中的任务分为同步任务和异步任务</p> <h2 id="_2-为什么需要异步"><a href="#_2-为什么需要异步" class="header-anchor">#</a> 2. 为什么需要异步？</h2> <blockquote><p>为了能够解决单线程带来的代码阻塞等问题</p></blockquote> <p>JS 是单线程的，我们可以想象成有一个售票窗口，有很多人在窗口排队办理业务，而 JS 只能一个一个处理，那如果有一个客户的需求很多，办理业务的时间很长，那么这条队伍的其他人就只能干等着了，就相当于代码阻塞了，也就是浏览器<strong>假死</strong>，等待代码执行</p> <p>因此有了同步任务和异步任务的概念</p> <p>就是需要通过这样来区分，将那些办理业务时间长的分出来，等到其他客户处理完毕之后再统一处理</p> <p>关于同步任务和异步任务是这样解释的</p> <ul><li>同步任务：是在主线程上排队执行的任务，只有前一个任务执行完毕，才能执行后一个任务，例如：<code>console.log</code></li> <li>异步任务：不进入主线程、通过事件循环机制处理，在任务队列中注册回调函数最终拿到结果，例如：<code>setTimeout</code></li></ul> <p>了解了什么是同步，什么是异步，我们来一道非常简单的题目</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>结果输出 1 3 2</p> <p>原因是 <code>setTimeout</code> 是异步任务，需要在同步代码执行之后再执行</p> <p>接下来我们聊聊运行机制的核心：事件循环</p> <h2 id="_3-事件循环"><a href="#_3-事件循环" class="header-anchor">#</a> 3. 事件循环</h2> <p>首先我们用一张图来理解事件循环</p> <p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210818224430488.png" alt="image-20210818224430488"></p> <p>它的运行机制如下：</p> <ol><li>所有同步任务在主线程上执行，形成一个执行栈，也就是上图蓝色箭头表示</li> <li>主线程以外有一个异步任务队列（红色箭头），会等到异步任务<strong>返回结果后</strong>将它放入<strong>任务队列</strong></li> <li>当主线程中执行栈代码执行完毕，也就是同步任务执行完毕，就会<strong>开始读取</strong>任务队列代码，再放入执行栈中执行</li> <li>不断地重复上面三步，这就是事件循环</li></ol> <p>用图形来描绘的话，就是上图中的<strong>三个黑色箭头</strong>，连成的闭环</p> <p>也就是说：<strong>只要主线程执行栈空了，就会去读取任务队列，这个过程是循环不断的，这种运行机制就叫做事件循环</strong></p> <p>了解了事件循环，我们对前面那题做一个简单的升级</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这次输出了 1 -- 5 -- 2 -- 4 -- 3</p> <p>可能会有人会对 <code>3</code> 的输出有疑惑，首先定时器都是异步任务，会先被放入异步任务队列当中，需要等待异步任务<strong>返回结果后</strong>，再将回调函数放入任务队列当中，等待主线程来执行，因此，2 和 4 会在 3 之前输出</p> <h2 id="_4-异步任务队列细节"><a href="#_4-异步任务队列细节" class="header-anchor">#</a> 4. 异步任务队列细节</h2> <p>常见的会放入异步任务队列的事件</p> <ol><li>DOM 事件</li> <li>Promise</li> <li>Ajax 请求</li> <li><code>setTimeout</code> 和 <code>setlnterval</code></li> <li>文件上传</li></ol> <p>至于加入异步任务队列的时间，是需要根据当前异步任务而定的，<strong>不是说</strong>拿到异步任务直接添加到任务队列里面，是要等到当前异步任务执行完成返回结果，才将其放到任务队列里</p> <p>就拿 <code>setTimeout</code> 来说，是需要<strong>等待定时结束</strong>再将回调加入任务队列的</p> <p>也可以结合下图理解</p> <p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210819002424355.png" alt="image-20210819002424355"></p> <p>了解了任务队列，我们需要再谈一谈异步任务当中，又被细分出来的宏任务和微任务</p> <h2 id="_5-宏任务和微任务"><a href="#_5-宏任务和微任务" class="header-anchor">#</a> 5. 宏任务和微任务</h2> <p>宏任务队列可以有多个，微任务队列只有一个</p> <p>那么什么是宏任务，什么是微任务呢？</p> <ul><li>宏任务有：HTML解析、鼠标事件、键盘事件、网络请求、执行主线程js代码和定时器</li> <li>微任务有：<code>promise.then</code>，DOM 渲染，<code>async</code>，<code>process.nextTick</code></li></ul> <p>那它是怎么被执行的呢？</p> <ol><li><p>当执行栈中的同步任务执行完毕后，先执行微任务</p></li> <li><p>微任务队列执行完毕后，会读取宏任务</p></li> <li><p>执行宏任务的过程中，遇到微任务，再加入微任务队列</p></li> <li><p>宏任务执行完后，再次读取微任务队列，依次循环</p></li></ol> <p>画个图来辅助理解一下</p> <p>用一句简单的话来总结：<strong>微任务永远在宏任务执行之前被执行完毕</strong></p> <p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210819001618159.png" alt="image-20210819001618159"></p> <p><strong>特别注意</strong>的是：由于代码的入口就是一个 <code>script</code> 标签。因此，全局任务属于宏任务</p> <h2 id="_6-实战"><a href="#_6-实战" class="header-anchor">#</a> 6. 实战</h2> <p>在了解了这么多后，我们来看一到经典的面试题</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;7&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;11&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;12&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;13&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>答案是：1 -- 5 -- 11 -- 13 -- 6 -- 12 -- 2 -- 3 -- 4 -- 7 --  8 -- 9 -- 10</p> <p><strong>第一轮循环</strong></p> <ul><li>从全局任务入口，首先<strong>打印</strong>日志 <code>1</code></li> <li>遇到宏任务 <code>setTimeout</code> ，交给异步处理模块，记为<code>setTimeout1</code></li> <li>再遇到 promise 对象，<strong>打印</strong>日志 <code>5</code> ，将 <code>promise.then</code> 加入微任务队列，记做 <code>p1</code></li> <li>又遇到 <code>setTimeout</code> 交给异步处理模块，记为 <code>setTimeout2</code></li> <li>又遇到 <code>setTimeout</code> 交给异步处理模块，记为 <code>setTimeout3</code></li> <li>遇到 promise 对象，打印日志 <code>11</code> ，将 <code>promise.then</code> 加入微任务队列，记做 <code>p2</code></li> <li>遇到打印语句，直接打印日志 <code>13</code></li></ul> <p>本轮循环共打印：1 -- 5 -- 11 -- 13</p> <p>当前循环结果</p> <p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210819084640821.png" alt="image-20210819084640821"></p> <p><strong>第二轮循环</strong></p> <ul><li>首先执行微任务队列 <code>p1</code> 和 <code>p2</code> ，先进先出，先打印 <code>6</code> 再打印 <code>12</code></li> <li>微任务事件处理完毕，开始执行宏任务 <code>setTimeout1</code></li> <li>遇到打印语句，直接打印日志 <code>2</code></li> <li>又遇到 promise 对象，打印日志 <code>3</code>，将 <code>promise.then</code> 加入微任务队列，记做 <code>p3</code></li></ul> <p>第二轮循环结束</p> <p>当前运行图为</p> <p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210819084924330.png" alt="image-20210819084924330"></p> <p><strong>第三轮循环</strong></p> <ul><li>首先执行微任务队列，打印日志 <code>4</code></li> <li>微任务处理完毕，执行宏任务 <code>setTimeout2</code></li> <li>遇到打印语句，直接输出 <code>7</code></li></ul> <p>本轮循环结束</p> <p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210819085314165.png" alt="image-20210819085314165"></p> <p><strong>第四轮循环</strong></p> <ul><li>微任务队列为空，执行宏任务 <code>setTimeout3</code></li> <li>遇到打印语句，打印日志 <code>8</code></li> <li>遇到 promise 对象，执行打印语句，打印 <code>9</code></li> <li>将 <code>promise.then</code> 加入微任务队列 记做 <code>p4</code></li></ul> <p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210819085545680.png" alt="image-20210819085545680"></p> <p><strong>第五轮循环</strong></p> <ul><li>首先清空微任务队列，执行打印语句，打印 <code>10</code></li> <li>执行完毕</li></ul> <p>以上就是关于 JavaScript 运行机制的全部内容，希望能有所收获</p> <blockquote><p>非常感谢您的阅读，欢迎提出你的意见，有什么问题欢迎指出，谢谢！🎈</p></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">lastUpdate:</span> <span class="time">5/2/2022, 1:28:46 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/summary/weakmap.html" class="prev">
        浅析 Map 和 WeakMap 区别以及使用场景
      </a></span> <span class="next"><a href="/pages/summary/inherit.html">
        JS 继承的7种方法，你学会了吗？
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.84aca76e.js" defer></script><script src="/assets/js/2.195f2158.js" defer></script><script src="/assets/js/55.6a8113fb.js" defer></script>
  </body>
</html>
