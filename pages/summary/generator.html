<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>【深扒】JavaScript 中的生成器 | 小丞前端之路</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/orange.png">
    <meta name="description" content="写在前面 在上篇文章中，我们深入了理解了迭代器的原理和作用，这一篇我们来深扒与迭代器息息相关的生成器。">
    
    <link rel="preload" href="/assets/css/0.styles.c6d750c1.css" as="style"><link rel="preload" href="/assets/js/app.84aca76e.js" as="script"><link rel="preload" href="/assets/js/2.195f2158.js" as="script"><link rel="preload" href="/assets/js/50.643246ed.js" as="script"><link rel="prefetch" href="/assets/js/10.19dacd57.js"><link rel="prefetch" href="/assets/js/11.554dfe83.js"><link rel="prefetch" href="/assets/js/12.872cae40.js"><link rel="prefetch" href="/assets/js/13.49623c48.js"><link rel="prefetch" href="/assets/js/14.820dbeb4.js"><link rel="prefetch" href="/assets/js/15.8e03246d.js"><link rel="prefetch" href="/assets/js/16.02f01159.js"><link rel="prefetch" href="/assets/js/17.40710f51.js"><link rel="prefetch" href="/assets/js/18.eb977535.js"><link rel="prefetch" href="/assets/js/19.e9c20797.js"><link rel="prefetch" href="/assets/js/20.741e51c3.js"><link rel="prefetch" href="/assets/js/21.60b540ac.js"><link rel="prefetch" href="/assets/js/22.cfaa5929.js"><link rel="prefetch" href="/assets/js/23.eaa38f81.js"><link rel="prefetch" href="/assets/js/24.734bd00e.js"><link rel="prefetch" href="/assets/js/25.526c02ff.js"><link rel="prefetch" href="/assets/js/26.ae528570.js"><link rel="prefetch" href="/assets/js/27.f6d05eee.js"><link rel="prefetch" href="/assets/js/28.e13ce5e2.js"><link rel="prefetch" href="/assets/js/29.d44f5e71.js"><link rel="prefetch" href="/assets/js/3.9ef2866a.js"><link rel="prefetch" href="/assets/js/30.46ef531d.js"><link rel="prefetch" href="/assets/js/31.92a3ad27.js"><link rel="prefetch" href="/assets/js/32.b7a8a4bb.js"><link rel="prefetch" href="/assets/js/33.5f8bcb25.js"><link rel="prefetch" href="/assets/js/34.9d1ef303.js"><link rel="prefetch" href="/assets/js/35.314c49c4.js"><link rel="prefetch" href="/assets/js/36.82828e59.js"><link rel="prefetch" href="/assets/js/37.d11e77ed.js"><link rel="prefetch" href="/assets/js/38.1ba8c945.js"><link rel="prefetch" href="/assets/js/39.006d6795.js"><link rel="prefetch" href="/assets/js/4.d68eba5c.js"><link rel="prefetch" href="/assets/js/40.a0757091.js"><link rel="prefetch" href="/assets/js/41.0465ba85.js"><link rel="prefetch" href="/assets/js/42.ad52fa52.js"><link rel="prefetch" href="/assets/js/43.0ca69b9d.js"><link rel="prefetch" href="/assets/js/44.fcbe4b55.js"><link rel="prefetch" href="/assets/js/45.c1f60df9.js"><link rel="prefetch" href="/assets/js/46.aaf4c807.js"><link rel="prefetch" href="/assets/js/47.0d7af8bb.js"><link rel="prefetch" href="/assets/js/48.6bac5f1d.js"><link rel="prefetch" href="/assets/js/49.e62f1089.js"><link rel="prefetch" href="/assets/js/5.73e212b6.js"><link rel="prefetch" href="/assets/js/51.dacd1276.js"><link rel="prefetch" href="/assets/js/52.fce8bdff.js"><link rel="prefetch" href="/assets/js/53.e7921e5a.js"><link rel="prefetch" href="/assets/js/54.f42c4ff3.js"><link rel="prefetch" href="/assets/js/55.6a8113fb.js"><link rel="prefetch" href="/assets/js/56.24479220.js"><link rel="prefetch" href="/assets/js/57.d18d7f86.js"><link rel="prefetch" href="/assets/js/58.533f3d2c.js"><link rel="prefetch" href="/assets/js/59.8e258a6a.js"><link rel="prefetch" href="/assets/js/6.c352959d.js"><link rel="prefetch" href="/assets/js/60.4d2d6af0.js"><link rel="prefetch" href="/assets/js/61.346c29af.js"><link rel="prefetch" href="/assets/js/7.a48ee71d.js"><link rel="prefetch" href="/assets/js/8.7c498576.js"><link rel="prefetch" href="/assets/js/9.8a5b8813.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c6d750c1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/orange.png" alt="小丞前端之路" class="logo"> <span class="site-name can-hide">小丞前端之路</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="各类知识点" class="dropdown-title"><span class="title">各类知识点</span> <span class="arrow down"></span></button> <button type="button" aria-label="各类知识点" class="mobile-dropdown-title"><span class="title">各类知识点</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/summary/qrcode.html" class="nav-link">
  前端总结
</a></li><li class="dropdown-item"><!----> <a href="/pages/structure/start.html" class="nav-link">
  数据结构和算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端面试合集" class="dropdown-title"><span class="title">前端面试合集</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端面试合集" class="mobile-dropdown-title"><span class="title">前端面试合集</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/interview/heading/best1.html" class="nav-link">
  面试题精选
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React 全家桶" class="dropdown-title"><span class="title">React 全家桶</span> <span class="arrow down"></span></button> <button type="button" aria-label="React 全家桶" class="mobile-dropdown-title"><span class="title">React 全家桶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/react/primary/jsx.html" class="nav-link">
  React 入门
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于我" class="dropdown-title"><span class="title">关于我</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于我" class="mobile-dropdown-title"><span class="title">关于我</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/about/about.html" class="nav-link">
  关于我
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/linjunc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1460594842018446" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/m0_50855872" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="各类知识点" class="dropdown-title"><span class="title">各类知识点</span> <span class="arrow down"></span></button> <button type="button" aria-label="各类知识点" class="mobile-dropdown-title"><span class="title">各类知识点</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/summary/qrcode.html" class="nav-link">
  前端总结
</a></li><li class="dropdown-item"><!----> <a href="/pages/structure/start.html" class="nav-link">
  数据结构和算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端面试合集" class="dropdown-title"><span class="title">前端面试合集</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端面试合集" class="mobile-dropdown-title"><span class="title">前端面试合集</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/interview/heading/best1.html" class="nav-link">
  面试题精选
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React 全家桶" class="dropdown-title"><span class="title">React 全家桶</span> <span class="arrow down"></span></button> <button type="button" aria-label="React 全家桶" class="mobile-dropdown-title"><span class="title">React 全家桶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/react/primary/jsx.html" class="nav-link">
  React 入门
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于我" class="dropdown-title"><span class="title">关于我</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于我" class="mobile-dropdown-title"><span class="title">关于我</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/about/about.html" class="nav-link">
  关于我
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/linjunc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1460594842018446" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/m0_50855872" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端总结</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/summary/qrcode.html" class="sidebar-link">如何优雅的在 H5 网页中实现扫码功能</a></li><li><a href="/pages/summary/animate.html" class="sidebar-link">为什么 CSS 动画比 JavaScript 高效？</a></li><li><a href="/pages/summary/git.html" class="sidebar-link">通俗易懂的GIT入门</a></li><li><a href="/pages/summary/prototype.html" class="sidebar-link">三张图轻松KO⚡ JS 原型和原型链</a></li><li><a href="/pages/summary/v8.html" class="sidebar-link">你知道 V8 是如何执行JS代码的吗？</a></li><li><a href="/pages/summary/weakmap.html" class="sidebar-link">浅析 Map 和 WeakMap 区别以及使用场景</a></li><li><a href="/pages/summary/jsrun.html" class="sidebar-link">新生代总结 JavaScript 运行机制解析</a></li><li><a href="/pages/summary/inherit.html" class="sidebar-link">JS 继承的7种方法，你学会了吗？</a></li><li><a href="/pages/summary/arrayapi.html" class="sidebar-link">原生 JavaScript 手写数组 API</a></li><li><a href="/pages/summary/iterator.html" class="sidebar-link">【深扒】JavaScript 中的迭代器</a></li><li><a href="/pages/summary/generator.html" aria-current="page" class="active sidebar-link">【深扒】JavaScript 中的生成器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/summary/generator.html#写在前面" class="sidebar-link">写在前面</a></li><li class="sidebar-sub-header"><a href="/pages/summary/generator.html#一个例子了解生成器" class="sidebar-link">一个例子了解生成器</a></li><li class="sidebar-sub-header"><a href="/pages/summary/generator.html#基本概念" class="sidebar-link">基本概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/summary/generator.html#_1-函数声明" class="sidebar-link">1. 函数声明</a></li><li class="sidebar-sub-header"><a href="/pages/summary/generator.html#_2-yield-表达式" class="sidebar-link">2. yield 表达式</a></li><li class="sidebar-sub-header"><a href="/pages/summary/generator.html#_3-一定需要-yield-语句吗" class="sidebar-link">3. 一定需要 yield 语句吗？</a></li><li class="sidebar-sub-header"><a href="/pages/summary/generator.html#_4-注意" class="sidebar-link">4. 注意</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/summary/generator.html#如何理解-generator-函数是状态机" class="sidebar-link">如何理解 Generator 函数是状态机？</a></li><li class="sidebar-sub-header"><a href="/pages/summary/generator.html#next-传递参数" class="sidebar-link">next 传递参数</a></li><li class="sidebar-sub-header"><a href="/pages/summary/generator.html#与-iterator-接口的关系" class="sidebar-link">与 Iterator 接口的关系</a></li><li class="sidebar-sub-header"><a href="/pages/summary/generator.html#提前终止生成器" class="sidebar-link">提前终止生成器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/summary/generator.html#return" class="sidebar-link">return</a></li><li class="sidebar-sub-header"><a href="/pages/summary/generator.html#throw" class="sidebar-link">throw</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/summary/generator.html#next-、throw-、return-的共同点" class="sidebar-link">next()、throw()、return() 的共同点</a></li><li class="sidebar-sub-header"><a href="/pages/summary/generator.html#yield-表达式" class="sidebar-link">yield* 表达式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/summary/generator.html#使用-yield-实现递归算法" class="sidebar-link">使用 yield* 实现递归算法</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/summary/generator.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/pages/summary/highf.html" class="sidebar-link">JavaScript中的高阶函数</a></li><li><a href="/pages/summary/npm.html" class="sidebar-link">经常使用npm命令，你真的知道它的意思吗？</a></li><li><a href="/pages/summary/storage.html" class="sidebar-link">Javascript客户端存储技术你知道多少？</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>📢 大家好，我是小丞同学，本文将会带你理解 <code>ES6</code> 中的<strong>生成器</strong>。</p></blockquote> <h2 id="写在前面"><a href="#写在前面" class="header-anchor">#</a> 写在前面</h2> <p>在上篇文章中，我们深入了理解了迭代器的原理和作用，这一篇我们来深扒与迭代器息息相关的<strong>生成器</strong>。</p> <p>关于生成器有这样的描述</p> <p><strong>红宝书</strong>：生成器是 <code>ES6</code> 新增的一个极为灵活的结构，拥有在一个<strong>函数块内暂停和恢复代码</strong>执行的能力</p> <p><strong>阮一峰老师</strong>：<code>Generator</code> 函数是 <code>ES6</code> 提供的一种异步编程解决方案</p> <p>从上面的两段话中，我们可以知道生成器有着<strong>至少两个作用</strong>：</p> <ol><li>打破完整运行，拥有暂停和启动的能力</li> <li>解决异步操作</li></ol> <p>下面我们来看看生成器是如何实现这些功能的</p> <h2 id="一个例子了解生成器"><a href="#一个例子了解生成器" class="header-anchor">#</a> 一个例子了解生成器</h2> <p>我们先来看一个例子</p> <p>下面是一个 <code>for</code> 循环的例子，会在每次循环中输出当前的 <code>index</code> ，这段代码很也是简单的生成了 0-5 这些数字</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 输出 0 1 2 3 4 5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>我们再来看看利用<strong>生成器函数</strong>是怎么实现的</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generatorForLoop</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> num<span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">yield</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> gen <span class="token operator">=</span> <span class="token function">generatorForLoop</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>我们可以看到，只有调用 <code>next</code> 方法，才会向下执行，而不会一次产生所有值。这就是一个最简单的生成器了。在某些场景下，这种特性就成为了它的杀手锏</p> <h2 id="基本概念"><a href="#基本概念" class="header-anchor">#</a> 基本概念</h2> <h3 id="_1-函数声明"><a href="#_1-函数声明" class="header-anchor">#</a> 1. 函数声明</h3> <p>生成器的形式是一个函数，函数名称前面加一个星号 <code>*</code> 表示它是一个生成器。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 函数声明</span>
<span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">generator</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// 函数表达式</span>
<span class="token keyword">let</span> <span class="token function-variable function">generator</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在定义一个生成器时，星号的位置在函数名前，但是位置没有明确的要求，不需要考虑挨着谁，都可以</p> <blockquote><p>只要是可以定义函数的地方，就可以定义生成器。</p> <p><strong>需要特别注意的是：箭头函数不能用来定义生成器</strong></p></blockquote> <h3 id="_2-yield-表达式"><a href="#_2-yield-表达式" class="header-anchor">#</a> 2. yield 表达式</h3> <p>函数体内部使用<code>yield</code>表达式，定义不同的内部状态，我们来看一段代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">helloWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">'world'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">'ending'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在上面的代码中定义了一个生成器函数 <code>helloWorld</code> ，内部有两个 <code>yield</code> 表达式，三个状态：hello，world 和 return 语句</p> <p>作为生成器的核心，单纯这么解释可能还是不能明白 <code>yield</code> 的作用以及它的使用方法</p> <p>下面我们来展开说说 <code>yield</code> 关键字</p> <p>首先它和 <code>return</code> 关键字有些许的类似，<code>return</code>  语句会在完成函数调用后返回值，但是在 <code>return</code> 语句之后无法进行任何操作</p> <p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210812111012666.png" alt="image-20210812111012666"></p> <p>可以看到在编译器中第一个 <code>return</code> 语句之后的代码变灰了，说明了没有生效。但是<code>yield</code>的工作方式却不同，我们再来看看 <code>yield</code> 是如何工作的</p> <p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210812112332270.png" alt="image-20210812112332270"></p> <p><strong>注意</strong>：<code>yield</code>  关键字只能在生成器函数内部使用，其他地方使用会抛出错误</p> <p>首先生成器函数会<strong>返回一个遍历器对象</strong>，只有通过调用 <code>next</code> 方法才会遍历下一个状态，而 <code>yield</code> 就是一个暂停的标志</p> <p>在上面的代码中，首先声明了一个生成器函数，利用 <code>myR</code> 变量接收生成器函数的返回值，也就是上面所说的<strong>遍历器对象</strong>，此时遍历器对象处于<strong>暂停状态</strong>。</p> <p>当调用 <code>next</code> 方法时，开始执行，遇到 <code>yield</code> 表达式，就暂停后面的操作，将 <code>yield</code> 后面的表达式的值，作为返回的对象的 <code>value</code> 值，因此第一个 <code>myR.next()</code> 中的 <code>value</code> 值为 <code>8</code></p> <p>再次调用 <code>next</code> 方法时，再继续向下执行，遇到 <code>yield</code> 再停止，后续操作一致</p> <p>需要<strong>注意</strong>的是，<code>yield</code> 表达式后面的表达式，只有当调用<code>next</code>方法，内部指针指向该语句时才会执行</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span>  <span class="token number">123</span> <span class="token operator">+</span> <span class="token number">456</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>就例如上面的代码中，<code>yield</code>后面的表达式 <code>123 + 456</code> ，不会立即求值，只会在 <code>next</code> 方法将指针移到这一句时，才会求值。</p> <p>因此可以理解为 <code>return</code> 是结束， <code>yield</code> 是停止</p> <h3 id="_3-一定需要-yield-语句吗"><a href="#_3-一定需要-yield-语句吗" class="header-anchor">#</a> 3. 一定需要 yield 语句吗？</h3> <p>其实在生成器函数中也<strong>可以没有</strong><code>yield</code>表达式，但是生成器的特性还在，那么它就变成了一个单纯的<strong>暂缓执行函数</strong>，只有在调用该函数的遍历器对象的 <code>next</code> 方法才会执行</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'现在执行'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 生成遍历器对象</span>
<span class="token keyword">let</span> generator <span class="token operator">=</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 开始执行</span>
    generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-注意"><a href="#_4-注意" class="header-anchor">#</a> 4. 注意</h3> <p><code>yield</code> 表达式如果用在另一个表达式中，必须放在圆括号里</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello'</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// OK</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>yield</code> 表达式用作函数参数可以不加括号</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token string">'a'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="如何理解-generator-函数是状态机"><a href="#如何理解-generator-函数是状态机" class="header-anchor">#</a> 如何理解 Generator 函数是状态机？</h2> <p>在阮一峰老师的 <code>ES6</code> 书籍上有着对生成器函数这样的理解</p> <blockquote><p><code>Generator</code> 函数有多种理解角度。语法上，首先可以把它理解成，Generator 函数是一个状态机，封装了多个内部状态。</p></blockquote> <p>书上说，<code>Generator</code> 函数是状态机，这是什么意思呢，状态机又怎么理解呢？</p> <p>这个和 <code>JavaScript</code> 的状态模式有些许关联</p> <p>状态模式：当一个对象的内部状态发生改变时，会导致其行为的改变，这看起来像是改变了对象</p> <p>看到这些定义的时候，显然每个字都知道是什么意思，合起来却不知所云</p> <p>先不要慌，我们先来看看状态模式是个什么东西，写个状态机就明白了</p> <p>我们用一个洗衣机的例子，按一下电源键就打开，再按一下就关闭，我们先来实现这个</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> switches <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;打开洗衣机&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            state <span class="token operator">=</span> <span class="token string">&quot;on&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> <span class="token string">&quot;on&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;关闭洗衣机&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            state <span class="token operator">=</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>在上面的代码中，通过一个立即执行函数，返回一个函数，将状态 <code>state</code> 保存在函数内部，每次按下电源键调用 <code>switches</code> 函数即可。</p> <p>这样看起来很完美，下面我们改变一下需求，洗衣机上有一个调整模式的按钮，每按一下换一个模式，假设有快速、洗涤、漂洗、拖水怎么实现</p> <p>同样的我们还是可以采用 <code>if-else</code> 语句实现</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> switches <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token string">&quot;快速&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> <span class="token string">&quot;快速&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;洗涤模式&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            state <span class="token operator">=</span> <span class="token string">&quot;洗涤&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> <span class="token string">&quot;洗涤&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;漂洗模式&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            state <span class="token operator">=</span> <span class="token string">&quot;漂洗&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> <span class="token string">&quot;漂洗&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;脱水模式&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            state <span class="token operator">=</span> <span class="token string">&quot;脱水&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> <span class="token string">&quot;脱水&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;快速模式&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            state <span class="token operator">=</span> <span class="token string">&quot;快速&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>越来越复杂了，当模式再增多时，<code>if-else</code> 语句会越来越多，代码会难以阅读，你可能会说可以采用 <code>switch-case</code>  语句来实现，当然也可以，但是治标不治本。我们可不可以<strong>不采用判断语句</strong>实现呢。回到我们刚开始的定义</p> <blockquote><p>状态模式：当一个对象的内部状态发生改变时，会导致其行为的改变，这看起来像是改变了对象</p></blockquote> <p>咦，想想，洗衣机不正是需要实现状态改变，行为改变吗？那这正可以采用状态模式来实现呀，这里我们就直接引出我们的 <code>generator</code> 函数，<strong>通过控制状态来改变它的行为</strong></p> <p>利用原型来实现的方法太过于<strong>复杂和冗余</strong>了，就不展示了</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">fast</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;快速模式&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">wash</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;洗涤模式&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">rinse</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;漂洗模式&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">dehydration</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;脱水模式&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">models</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
        fn<span class="token punctuation">,</span> len <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fn <span class="token operator">=</span> arguments<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span>
        <span class="token keyword">yield</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> exe <span class="token operator">=</span> <span class="token function">models</span><span class="token punctuation">(</span>fast<span class="token punctuation">,</span> wash<span class="token punctuation">,</span> rinse<span class="token punctuation">,</span> dehydration<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//按照模式顺序排放</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>在上面的代码中我们只需要在每次按下时调用 <code>next</code> 方法即可切换下一个状态</p> <p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/%E7%94%9F%E6%88%90%E5%99%A8.gif" alt="生成器"></p> <p>说了这么多 <code>generator</code> 为什么说是状态机呢？我的理解是：当调用 <code>Generator</code> 函数获取一个迭代器时，状态机处于初态。迭代器调用 <code>next</code> 方法后，向下一个状态跳转，然后执行该状态的代码。当遇到 <code>return</code> 或最后一个 <code>yield</code> 时，进入终态。同时采用 <code>Generator</code> 实现的状态机是最佳的结构。</p> <h2 id="next-传递参数"><a href="#next-传递参数" class="header-anchor">#</a> next 传递参数</h2> <p>生成器的另一强大之处在于内建消息<strong>输入输出能力</strong>，而这一能力仰仗于 <code>yield</code> 和 <code>next</code>  方法</p> <p><code>yield</code> 表达式本身没有返回值，或者说总是返回 <code>undefined</code> 。 <code>next</code> 方法可以带一个参数，该参数就会被当作<strong>上一个</strong> <code>yield</code> 表达式的返回值。</p> <p>从语义上讲，第一个 <code>next</code> 方法用来<strong>启动遍历器对象</strong>，所以不用带有参数。</p> <p>来看一个例子</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">yield</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> y
<span class="token punctuation">}</span>
<span class="token keyword">const</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> res <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 42</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在上面的代码中，调用 <code>foo</code> 函数<strong>返回一个遍历器对象</strong> <code>it</code> ，并将 6 作为参数传递给 x ，调用遍历器对象的 <code>next</code> 方法，<strong>启动</strong>遍历器对象，并且运行到第一个 <code>yield</code> 位置停止，</p> <p>再次调用 <code>next</code> 方法传入参数 7 ，作为上一个 <code>yield</code> 表达式的返回值也就是 x 的乘项 <code>(yield)</code> 的值，运行到下一个 <code>yield</code> 或 <code>return</code> 结束</p> <p><strong>下面开始作死</strong></p> <p>在上面的例子中，如果不传递参数会这么样呢？
在第二次运行 <code>next</code> 方法的时候不带参数，导致了 y 的值等于 <code>6 * undefined</code> 也就是 <code>NaN</code> 所以返回的对象的 <code>value</code> 属性也是 <code>NaN</code></p> <p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210812182445067.png" alt="image-20210812182445067"></p> <p>我们<strong>再变一下</strong></p> <p>在原先的例子中，我们说第一个 <code>next</code> 是用来启动遍历器对象，那么如果传入参数会怎么样？</p> <p>其实这样传递参数是无效的，因为我们说 <code>next</code> 方法的参数表示上一个 <code>yield</code> 表达式的返回值。</p> <blockquote><p>V8 引擎直接忽略第一次使用 <code>next</code> 方法时的参数</p></blockquote> <h2 id="与-iterator-接口的关系"><a href="#与-iterator-接口的关系" class="header-anchor">#</a> 与 Iterator 接口的关系</h2> <p>在上一篇中我们知道，一个对象的 <code>Symbol.iterator</code> 方法，等于该对象的遍历器生成函数，调用该函数会返回一个遍历器对象</p> <p>在这一篇我们知道，生成器函数就是遍历器生成函数，那么是不是有什么想法了呢？</p> <p>我们可以把生成器赋值给对象的 <code>Symbol.iterator</code> 属性，实现 <code>iterator</code> 接口</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> myIterable <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
myIterable<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token operator">...</span>myIterable<span class="token punctuation">]</span> <span class="token comment">// [1, 2, 3]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="提前终止生成器"><a href="#提前终止生成器" class="header-anchor">#</a> 提前终止生成器</h2> <p>生成器函数返回的遍历器对象，都有 <code>next</code> 方法，以及可选的 <code>return</code> 方法和 <code>throw</code> 方法</p> <p>我们先来看 <code>return</code> 方法</p> <h3 id="return"><a href="#return" class="header-anchor">#</a> return</h3> <p><code>return</code> 方法会强制生成器进入关闭状态，提供给 <code>return</code> 方法的值，就是<strong>终止迭代器对象的值</strong>，也就是说此时返回的对象状态为<code>true</code>，值为传入的值。我们来验证一下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">genFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> x <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">yield</span> x
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 创建遍历器对象 g</span>
<span class="token keyword">const</span> g <span class="token operator">=</span> <span class="token function">genFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 手动结束</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span><span class="token function">return</span><span class="token punctuation">(</span><span class="token string">'结束'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在上面的代码中，输出了 <code>{value: &quot;结束&quot;, done: true}</code> ，这和我们预料的一样，我们生成了遍历器对象后，直接调用 <code>return</code> 终止了生成器</p> <p>如果生成器函数内部有 <code>try...finally</code> 代码块，且<strong>正在执行</strong> <code>try</code> 代码块，那么 <code>return()</code> 方法会导致立刻进入 <code>finally</code> 代码块，执行完以后，整个函数才会结束。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">genFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">yield</span> <span class="token number">111</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我在finally中'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">yield</span> <span class="token number">999</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 创建遍历器对象 g</span>
<span class="token keyword">const</span> g <span class="token operator">=</span> <span class="token function">genFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 启动</span>
g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span><span class="token function">return</span><span class="token punctuation">(</span><span class="token string">'结束'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20210812212044117.png" alt="image-20210812212044117"></p> <p>在上面的代码中，执行 <code>next</code> 函数，使得 <code>try</code> 代码块开始执行，再调用 <code>return</code> 方法，就会开始执行 <code>finally</code> 代码块，然后等待执行完毕，再返回 <code>return</code> 方法指定的返回值</p> <h3 id="throw"><a href="#throw" class="header-anchor">#</a> throw</h3> <p><code>throw()</code> 方法会在暂停的时候将一个提供的错误注入到生成器对象中。如果错误未被处理，生成器就会关闭</p> <p>在很多的资料中都说的很复杂，其实就很简单：</p> <p>有错误你就给我一个 <code>catch</code> 来处理掉，不然你就给我退出，就是这么霸道</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;state1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> state1 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token string">&quot;state1&quot;</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;state2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> state2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token string">&quot;state2&quot;</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> g <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
g<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在上面的代码中，<code>throw</code> 方法提出的错误，没有被处理，因此会被直接退出，因此上面的代码只会输出  <code>state1</code>  ，然后报错</p> <p>注意：可以给 <code>throw</code> 方法<strong>传递参数</strong>，用来解释错误</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>g<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'出错了！'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="next-、throw-、return-的共同点"><a href="#next-、throw-、return-的共同点" class="header-anchor">#</a> next()、throw()、return() 的共同点</h2> <p>到这里遍历器对象的3个方法，已经都涉及过了，虽然他们的功能各不相同，或者说完全没有关系，但是他们的本质确实在做同一件事，“采用语句替换 <code>yield</code> 表达式”</p> <p><code>next</code> 是将 <code>yield</code> 表达式替换成一个值</p> <p><code>throw</code>是将 <code>yield</code> 表达式替换成 <code>throw</code> 语句</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>gen<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'出错了'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Uncaught Error: 出错了</span>
<span class="token comment">// 相当于将 let result = yield x + y</span>
<span class="token comment">// 替换成 let result = throw(new Error('出错了'));</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>return</code> 是将 <code>yield</code> 表达式替换成 <code>return</code> 语句</p> <h2 id="yield-表达式"><a href="#yield-表达式" class="header-anchor">#</a> yield* 表达式</h2> <p>带星号的 <code>yield</code>，可以增强<code>yield</code>的行为，使它能够迭代一个可迭代对象，从而一次产出一个值，这也叫<strong>委托迭代</strong>。通过这样的方式，能将多个生成器连接在一起。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">anotherGenerator</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">anotherGenerator</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> gen <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 2</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 3</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>几个注意点：</p> <ol><li>任何数据结构只要有 <code>Iterator</code> 接口，就可以被<code>yield*</code>遍历。</li> <li>如果被代理的 <code>Generator</code> 函数有<code>return</code>语句，那么就可以向代理它的 <code>Generator</code> 函数返回数据。</li></ol> <h3 id="使用-yield-实现递归算法"><a href="#使用-yield-实现递归算法" class="header-anchor">#</a> 使用 yield* 实现递归算法</h3> <p>实现递归算法，这也是 yield* 最有用的地方，此时生成器可以产生自身</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">nTimes</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">nTimes</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">yield</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> x <span class="token keyword">of</span> <span class="token function">nTimes</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 0 1 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>上面的代码中，每个生成器首先会从新创建的生成器对象产出每个值，然后再产出一个整数。</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <p><a href="https://juejin.cn/post/6844903616357072910#heading-3" target="_blank" rel="noopener noreferrer">[译] 什么是 JavaScript 生成器？如何使用生成器？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>阮一峰老师  <a href="https://wangdoc.com/es6/generator.html" target="_blank" rel="noopener noreferrer">Generator 函数的语法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>《JavaScript高级程序设计第四版》</p> <hr> <p>上篇文章：<a href="https://linjc.blog.csdn.net/article/details/119535128" target="_blank" rel="noopener noreferrer">【深扒】 JavaScript 中的迭代器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>本文内容就到这里结束了，关于生成器的核心应用异步编码模式以及回调问题，将在下篇总结。</p> <blockquote><p>非常感谢您的阅读，欢迎提出你的意见，有什么问题欢迎指出，谢谢！🎈</p></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">lastUpdate:</span> <span class="time">5/2/2022, 1:28:46 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/summary/iterator.html" class="prev">
        【深扒】JavaScript 中的迭代器
      </a></span> <span class="next"><a href="/pages/summary/highf.html">
        JavaScript中的高阶函数
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.84aca76e.js" defer></script><script src="/assets/js/2.195f2158.js" defer></script><script src="/assets/js/50.643246ed.js" defer></script>
  </body>
</html>
