<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React 入门学习（九）-- 消息订阅发布 | 小丞前端日记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/orange.png">
    <meta name="description" content="引言 在前面写的 Github 案例中，我们采用的是 axios 发送请求来获取数据，同时我们需要将数据从 Search 中传入给 App，再由 App 组件再将数据传递给 List 组件，这样非常的复杂，我们可以采用发布订阅模式">
    
    <link rel="preload" href="/assets/css/0.styles.0cb4b130.css" as="style"><link rel="preload" href="/assets/js/app.a050530d.js" as="script"><link rel="preload" href="/assets/js/2.9ca92e07.js" as="script"><link rel="preload" href="/assets/js/54.4b0b5a0f.js" as="script"><link rel="prefetch" href="/assets/js/10.6e958c0c.js"><link rel="prefetch" href="/assets/js/11.95969b7c.js"><link rel="prefetch" href="/assets/js/12.4c68fcb9.js"><link rel="prefetch" href="/assets/js/13.b6894616.js"><link rel="prefetch" href="/assets/js/14.514c46cc.js"><link rel="prefetch" href="/assets/js/15.213684b6.js"><link rel="prefetch" href="/assets/js/16.3ec938ae.js"><link rel="prefetch" href="/assets/js/17.b676430d.js"><link rel="prefetch" href="/assets/js/18.9494a132.js"><link rel="prefetch" href="/assets/js/19.e1195932.js"><link rel="prefetch" href="/assets/js/20.6cf61f06.js"><link rel="prefetch" href="/assets/js/21.ee003277.js"><link rel="prefetch" href="/assets/js/22.2966ebdd.js"><link rel="prefetch" href="/assets/js/23.b956afce.js"><link rel="prefetch" href="/assets/js/24.b330257c.js"><link rel="prefetch" href="/assets/js/25.77b6aa14.js"><link rel="prefetch" href="/assets/js/26.e18839bd.js"><link rel="prefetch" href="/assets/js/27.9e901bf5.js"><link rel="prefetch" href="/assets/js/28.5de074c9.js"><link rel="prefetch" href="/assets/js/29.153f13ef.js"><link rel="prefetch" href="/assets/js/3.334401cf.js"><link rel="prefetch" href="/assets/js/30.17e368e3.js"><link rel="prefetch" href="/assets/js/31.34cda385.js"><link rel="prefetch" href="/assets/js/32.1e0f1e54.js"><link rel="prefetch" href="/assets/js/33.cf778f7a.js"><link rel="prefetch" href="/assets/js/34.ab8f668a.js"><link rel="prefetch" href="/assets/js/35.3221c626.js"><link rel="prefetch" href="/assets/js/36.0efd720d.js"><link rel="prefetch" href="/assets/js/37.4a116a1f.js"><link rel="prefetch" href="/assets/js/38.e6a60214.js"><link rel="prefetch" href="/assets/js/39.2a30a1bf.js"><link rel="prefetch" href="/assets/js/4.2007bec8.js"><link rel="prefetch" href="/assets/js/40.08c54456.js"><link rel="prefetch" href="/assets/js/41.cfee696d.js"><link rel="prefetch" href="/assets/js/42.125c5466.js"><link rel="prefetch" href="/assets/js/43.91a3cfe5.js"><link rel="prefetch" href="/assets/js/44.5428d32b.js"><link rel="prefetch" href="/assets/js/45.4f4528b1.js"><link rel="prefetch" href="/assets/js/46.6138ce94.js"><link rel="prefetch" href="/assets/js/47.aaebf4b6.js"><link rel="prefetch" href="/assets/js/48.078e43e3.js"><link rel="prefetch" href="/assets/js/49.0a44f322.js"><link rel="prefetch" href="/assets/js/5.85f6b89d.js"><link rel="prefetch" href="/assets/js/50.159e339a.js"><link rel="prefetch" href="/assets/js/51.336f0e09.js"><link rel="prefetch" href="/assets/js/52.42ebda8c.js"><link rel="prefetch" href="/assets/js/53.8e00c210.js"><link rel="prefetch" href="/assets/js/55.84b2fe5b.js"><link rel="prefetch" href="/assets/js/56.97062723.js"><link rel="prefetch" href="/assets/js/57.9055d09d.js"><link rel="prefetch" href="/assets/js/58.ace2216e.js"><link rel="prefetch" href="/assets/js/59.cfa34bfc.js"><link rel="prefetch" href="/assets/js/6.6e57d4a5.js"><link rel="prefetch" href="/assets/js/60.7b717444.js"><link rel="prefetch" href="/assets/js/61.61dbd9bc.js"><link rel="prefetch" href="/assets/js/62.28ff7373.js"><link rel="prefetch" href="/assets/js/63.cf07df7d.js"><link rel="prefetch" href="/assets/js/64.bd10ee7c.js"><link rel="prefetch" href="/assets/js/65.79a0b0f0.js"><link rel="prefetch" href="/assets/js/66.9f41c408.js"><link rel="prefetch" href="/assets/js/67.3ac14554.js"><link rel="prefetch" href="/assets/js/68.9cb1dee2.js"><link rel="prefetch" href="/assets/js/69.880cbf28.js"><link rel="prefetch" href="/assets/js/7.51410411.js"><link rel="prefetch" href="/assets/js/70.3d1c5ecc.js"><link rel="prefetch" href="/assets/js/71.d6138285.js"><link rel="prefetch" href="/assets/js/72.137b17ba.js"><link rel="prefetch" href="/assets/js/73.d6d94315.js"><link rel="prefetch" href="/assets/js/74.5e1b585c.js"><link rel="prefetch" href="/assets/js/75.c76a0b8c.js"><link rel="prefetch" href="/assets/js/76.550ca9f6.js"><link rel="prefetch" href="/assets/js/77.b95cc65d.js"><link rel="prefetch" href="/assets/js/78.585346b6.js"><link rel="prefetch" href="/assets/js/79.7a4027c9.js"><link rel="prefetch" href="/assets/js/8.87341fa7.js"><link rel="prefetch" href="/assets/js/80.cabf1199.js"><link rel="prefetch" href="/assets/js/81.f2d1dbce.js"><link rel="prefetch" href="/assets/js/82.06d96b08.js"><link rel="prefetch" href="/assets/js/83.6bced6da.js"><link rel="prefetch" href="/assets/js/9.d43ff011.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0cb4b130.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/orange.png" alt="小丞前端日记" class="logo"> <span class="site-name can-hide">小丞前端日记</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="各类知识点" class="dropdown-title"><span class="title">各类知识点</span> <span class="arrow down"></span></button> <button type="button" aria-label="各类知识点" class="mobile-dropdown-title"><span class="title">各类知识点</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/summary/qrcode.html" class="nav-link">
  前端总结
</a></li><li class="dropdown-item"><!----> <a href="/pages/structure/start.html" class="nav-link">
  数据结构和算法
</a></li><li class="dropdown-item"><!----> <a href="/pages/css/layout/flex.html" class="nav-link">
  CSS 布局方式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端面试合集" class="dropdown-title"><span class="title">前端面试合集</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端面试合集" class="mobile-dropdown-title"><span class="title">前端面试合集</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/interview/heading/best1.html" class="nav-link">
  面试题精选
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React 全家桶" class="dropdown-title"><span class="title">React 全家桶</span> <span class="arrow down"></span></button> <button type="button" aria-label="React 全家桶" class="mobile-dropdown-title"><span class="title">React 全家桶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/react/primary/jsx.html" class="nav-link">
  React 入门
</a></li><li class="dropdown-item"><!----> <a href="/pages/react/hard/fiberidea.html" class="nav-link">
  React 源码解析
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于我" class="dropdown-title"><span class="title">关于我</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于我" class="mobile-dropdown-title"><span class="title">关于我</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/about/about.html" class="nav-link">
  关于我
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/linjunc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1460594842018446" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/m0_50855872" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="各类知识点" class="dropdown-title"><span class="title">各类知识点</span> <span class="arrow down"></span></button> <button type="button" aria-label="各类知识点" class="mobile-dropdown-title"><span class="title">各类知识点</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/summary/qrcode.html" class="nav-link">
  前端总结
</a></li><li class="dropdown-item"><!----> <a href="/pages/structure/start.html" class="nav-link">
  数据结构和算法
</a></li><li class="dropdown-item"><!----> <a href="/pages/css/layout/flex.html" class="nav-link">
  CSS 布局方式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端面试合集" class="dropdown-title"><span class="title">前端面试合集</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端面试合集" class="mobile-dropdown-title"><span class="title">前端面试合集</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/interview/heading/best1.html" class="nav-link">
  面试题精选
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React 全家桶" class="dropdown-title"><span class="title">React 全家桶</span> <span class="arrow down"></span></button> <button type="button" aria-label="React 全家桶" class="mobile-dropdown-title"><span class="title">React 全家桶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/react/primary/jsx.html" class="nav-link">
  React 入门
</a></li><li class="dropdown-item"><!----> <a href="/pages/react/hard/fiberidea.html" class="nav-link">
  React 源码解析
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于我" class="dropdown-title"><span class="title">关于我</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于我" class="mobile-dropdown-title"><span class="title">关于我</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/about/about.html" class="nav-link">
  关于我
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/linjunc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1460594842018446" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/m0_50855872" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React 入门学习</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/react/primary/jsx.html" class="sidebar-link">基础知识以及 jsx语法</a></li><li><a href="/pages/react/primary/component.html" class="sidebar-link">面向组件编程</a></li><li><a href="/pages/react/primary/lifecycle.html" class="sidebar-link">组件的生命周期</a></li><li><a href="/pages/react/primary/diff.html" class="sidebar-link">diff 算法</a></li><li><a href="/pages/react/primary/cli.html" class="sidebar-link">初始化脚手架</a></li><li><a href="/pages/react/primary/todolist.html" class="sidebar-link">todoList案例</a></li><li><a href="/pages/react/primary/proxy.html" class="sidebar-link">脚手架配置代理</a></li><li><a href="/pages/react/primary/github.html" class="sidebar-link">GitHub 搜索案例</a></li><li><a href="/pages/react/primary/pubsub.html" aria-current="page" class="active sidebar-link">消息订阅发布</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/react/primary/pubsub.html#引言" class="sidebar-link">引言</a></li><li class="sidebar-sub-header"><a href="/pages/react/primary/pubsub.html#消息发布订阅" class="sidebar-link">消息发布订阅</a></li><li class="sidebar-sub-header"><a href="/pages/react/primary/pubsub.html#扩展-fetch" class="sidebar-link">扩展 -- Fetch</a></li></ul></li><li><a href="/pages/react/primary/router.html" class="sidebar-link">React 路由</a></li><li><a href="/pages/react/primary/params.html" class="sidebar-link">React 路由传参</a></li><li><a href="/pages/react/primary/react-router.html" class="sidebar-link"> React 路由跳转</a></li><li><a href="/pages/react/primary/antd.html" class="sidebar-link">antd 的基本使用</a></li><li><a href="/pages/react/primary/redux.html" class="sidebar-link">redux 的基本使用</a></li><li><a href="/pages/react/primary/react-redux.html" class="sidebar-link">react-redux 的基本使用</a></li><li><a href="/pages/react/primary/share.html" class="sidebar-link">数据共享</a></li><li><a href="/pages/react/primary/more.html" class="sidebar-link">React 扩展</a></li><li><a href="/pages/react/primary/hooks.html" class="sidebar-link">React Hooks</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><img src="https://ljcimg.oss-cn-beijing.aliyuncs.com/img/react-%E6%B6%88%E6%81%AF%E8%AE%A2%E9%98%85.gif" alt="react-消息订阅"></p> <blockquote><p>📢 大家好，我是小丞同学，一名<font color="#2e86de"><strong>大二的前端爱好者</strong></font></p> <p>📢 这篇文章是学习 React 中 GitHub 搜索案例的学习笔记</p> <p>📢 非常感谢你的阅读，不对的地方欢迎指正 🙏</p> <p>📢 <font color="#f368e0"><strong>愿你忠于自己，热爱生活</strong></font></p></blockquote> <h2 id="引言"><a href="#引言" class="header-anchor">#</a> 引言</h2> <p>在昨天写的 <code>Github</code> 案例中，我们采用的是 <code>axios</code> 发送请求来获取数据，同时我们需要将数据从 <code>Search</code> 中传入给 <code>App</code>，再由 <code>App</code> 组件再将数据传递给 <code>List</code> 组件，这个过程会显得多此一举。同时我们要将 <code>state</code> 状态存放在 <code>App</code> 组件当中，但是这些 <code>state</code> 状态都是在 <code>List</code> 组件中使用的，在 <code>Search</code> 组件中做的，只是更新这些数据，那这样也会显得很没有必要，我们完全可以将 <code>state</code> 状态存放在 <code>List</code> 组件中，但是这样我们又会遇到技术难题，兄弟组件间的数据通信。那这里我们就学习一下如何利用消息订阅发布来解决<strong>兄弟组件间的通信</strong></p> <h2 id="消息发布订阅"><a href="#消息发布订阅" class="header-anchor">#</a> 消息发布订阅</h2> <p>要解决上面的问题，我们可以借助发布订阅的机制，我们可以将 App 文件中的所有状态和方法全部去除，因为本来就不是在 App 组件中直接使用这些方法的，App 组件只是一个中间媒介而已</p> <p>我们先简单的说一下<strong>消息订阅和发布的机制</strong></p> <p>就拿我们平常订杂志来说，我们和出版社说我们要订一年的足球周刊，那每次有新的足球周刊，它都会寄来给你。</p> <p>换到代码层面上，我们订阅了一个消息假设为 A，当另一个人发布了 A 消息时，因为我们订阅了消息 A ，那么我们就可以拿到 A 消息，并获取数据</p> <p>那我们要怎么实现呢？</p> <p>首先引入 <code>pubsub-js</code></p> <p>我们需要先安装这个库</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>yarn add pubsub<span class="token operator">-</span>js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>引入这个库</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> PubSub <span class="token keyword">from</span> <span class="token string">'pubsub-js'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>订阅消息</p> <p>我们通过 <code>subscribe</code> 来订阅消息，它接收两个参数，第一个参数是消息的名称，第二个是消息成功的回调，回调中也接受两个参数，一个是消息名称，一个是返回的数据</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>PubSub<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'search'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>发布消息</p> <p>我们采用 <code>publish</code> 来发布消息，用法如下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>PubSub<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'search'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'tom'</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>有了这些基础，我们可以完善我们昨天写的 GitHub 案例</p> <p>将数据的更新通过 <code>publish</code> 来传递，例如在发送请求之前，我们需要出现 loading 字样</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 之前的写法</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">updateAppState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">isFirst</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">isLoading</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 改为发布订阅方式</span>
PubSub<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'search'</span><span class="token punctuation">,</span><span class="token punctuation">{</span> <span class="token literal-property property">isFirst</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">isLoading</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这样我们就能成功的在请求之前发送消息，我们只需要在 List 组件中订阅一下这个消息即可，并将返回的数据用于更新状态即可</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>PubSub<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'search'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span>stateObj</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>stateObj<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>同时上面的代码会返回一个 <code>token</code> ，这个就类似于定时器的编号的存在，我们可以通过这个 <code>token</code> 值，来取消对应的订阅</p> <p>通过 <code>unsubscribe</code> 来取消指定的订阅</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>PubSub<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>token<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="扩展-fetch"><a href="#扩展-fetch" class="header-anchor">#</a> 扩展 -- Fetch</h2> <p>首先 fetch 也是一种发送请求的方式，它是在 xhr 之外的一种，我们平常用的 Jquery 和 axios 都是封装了 xhr 的第三方库，而 fetch 是官方自带的库，同时它也采用的是 Promise 的方式，大大简化了写法</p> <p>如何使用呢？</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://xxx'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">json</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Request Failed'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>它的使用方法和 axios 非常的类似，都是返回 Promise 对象，但是不同的是， fetch 关注分离，它在第一次请求时，不会直接返回数据，会先返回联系服务器的状态，在第二步中才能够获取到数据</p> <p>我们需要在第一次 <code>then</code> 中返回 <code>response.json()</code> 因为这个是包含数据的 promise 对象，再调用一次 <code>then</code> 方法即可实现</p> <p>但是这么多次的调用 <code>then</code> 并不是我们所期望的，相信看过之前生成器的文章的伙伴，已经有了想法。</p> <p>我们可以利用 <code>async</code> 和 <code>await</code> 配合使用，来简化代码</p> <p>可以将 <code>await</code> 理解成一个自动执行的 <code>then</code> 方法，这样清晰多了</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">'https://xxx'</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> reasponse<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Request Failed'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>最后关于错误对象的获取可以采用 <code>try...catch</code> 来实现</p> <p>关于 fetch 的更多内容</p> <p>强烈推荐阮一峰老师的博文：<a href="http://www.ruanyifeng.com/blog/2020/12/fetch-tutorial.html" target="_blank" rel="noopener noreferrer">fetch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <hr> <blockquote><p>非常感谢您的阅读，欢迎提出你的意见，有什么问题欢迎指出，谢谢！🎈</p></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">lastUpdate:</span> <span class="time">7/20/2022, 2:14:02 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/react/primary/github.html" class="prev">
        GitHub 搜索案例
      </a></span> <span class="next"><a href="/pages/react/primary/router.html">
        React 路由
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a050530d.js" defer></script><script src="/assets/js/2.9ca92e07.js" defer></script><script src="/assets/js/54.4b0b5a0f.js" defer></script>
  </body>
</html>
