# 数据链路层

## 功能

数据链路层在物理层提供服务的基础上 `向网络层提供服务`，其最基本的服务是将源自 `网络层` 的数据可靠地传输到相邻节点的 `目标机网络层` 。
其主要作用是**加强物理层传输原始比特流的功能**，将物理层提供的 `可能出错` 的物理连接改造成为逻辑上 `无差错` 的数据链路，使之对网络层表现为一条无差错的链路。

- 功能一：为网络层提供服务。
  - 无确认无连接服务
  - 有确认无连接服务
  - 有确认面向连接服务。（有连接一定有确认）
- 功能二：链路管理，即连接的建立、维持、释放（用于面向连接的服务）
- 功能三：组帧
- 功能四：流量控制（限制发送速度）
- 功能五：差错控制（帧错/位错）

## 封装成帧

封装成帧的目的就是**让数据能够被识别，在数据丢失时，能够溯源**

在实际操作上，封装成帧就是在一段 `数据的前后添加首部和尾部` ，构成帧。接收端在收到物理层上交的比特流后，就能根据首部和尾部的标记，从收到的比特流中 `识别帧的开始和结束`。

因此，首部和尾部一个重要的作用就是：帧定界（由帧定界符控制），当然它还包含了许多的控制信息

帧同步：**接收方**应当能从接收到的二进制比特流中区分出帧的起始和终止

![datalink-1](/img/network/datalink/datalink-1.png)

组帧的四种方法：

1. 字符计数法
2. 字符（节）填充法
3. 零比特填充法
4. 违规编码法

## 透明传输

意思就是不管所传输的数据是什么样的比特组合，**都可以在链路上传输**。链路层看不见有什么东西妨碍了数据的传输，

帧使用首部和尾部进行定界

- 如果帧的 `数据部分` 含有和首部尾部 `相同的内容` ，那么帧的开始和结束位置就会被 `错误的判定` 。需要在数据部分出现首部尾部相同的内容前面 `插入转义字符`。
- 如果数据部分出现转义字符，那么就在转义字符前面再加个转义字符。
- 在接收端进行处理之后可以还原出原始数据。这个过程透明传输的内容是转义字符，**用户察觉不到转义字符**的存在。

### 字符填充法

**加头加尾分别标记开始结束**，和零比特填充法（见下）对比，开始和结束的对应的字符不一样

但有**可能出现数据内某段比特流数据正好与标记字段重复**，从而导致误判断的情况

因此会通过添加 `转义字符` ，来标记那些重复的数据，在解析的时候就不会认为这些数据为开始和结束了

![datalink-2-1](/img/network/datalink/datalink-2-1.png)

### 零比特填充法

和字符填充的思路是差不多的，零比特填充首位的标志位都是一样的 `0111110`

因此，在数据流中也有可能存在相同的字符，这里会采用补 0 的方式，来解决这个冲突的问题

- 在发送端，会扫描整个信息字段，只要连续 5 个 1，就会填入 1 个 0
- 在接收端，会对比特流进行扫描，发现 5 个连续的 1 时，就会删除后面的 0

![datalink-2-2](/img/network/datalink/datalink-2-2.png)

## 差错控制（检错编码）

传输中的差错都是由噪声引起的。可以通过 `提高信噪比` 来减少或者避免干扰。

### 奇偶校验码

操作方法就是：发送的时候通过添加一位附加比特来形成奇数码

奇偶校验码特点：只能检查出奇数个比特错误，检错能力为 50%

因为，一段数据中，一个从 0 --> 1 ，一个从 1 --> 0 ，0，1 的数量是不变的，无法检测出错误。只能检测出 1，3，5 等这些奇位数错误

![datalink-3](/img/network/datalink/datalink-3.png)

### 循环冗余码 CRC

- 循环冗余检验 CRC
  - 目前数据链路层广泛使用了 `循环冗余检验`（CRC）来检查比特差错。
- 帧检验序列 FCS
  - `在数据后面添加上的冗余码` 称为帧检验序列 FCS (Frame Check Sequence)。
- 概要: CRC 是一种常用的检错方法，而 FCS 是添加在数据后面的冗余码。
  - FCS 可以用 CRC 这种方法得出，但 CRC 并非用来获得 FCS 的唯一方法。

如果数据链路层接收了这个帧，说明这个帧没有差错

这种也不是可靠传输，因为有一些帧会被丢弃掉，并不是发送什么就接受什么

## 差错控制（纠错编码）

### 海明码

1. 首先需要确认检验码的位数
   - 满足 2 的 r 次方 大于等于 k + r + 1
2. 确定校验码和数据的位置
   - 检验码放在 2 的次方的位置，1，2，4，8...
   - 数据依次添满
3. 求出校验码的值
    - 通过二进制位确定有几位
    - 然后看检验码的二进制位的数值和所有信息位的**对应位置**的数值是否相同，然后找出来这些位
      - 例如第一个检验码 0001，那么和他一起的信息码就是第一位为 1 的，例如 0011,0111,这些都是
    - 接着把这些数异或一下，就是这些检验码的值
4. 检错并纠错
   - 按照检错的位数，通过异或来得到出错的是第几位

## 流量控制与可靠传输机制
